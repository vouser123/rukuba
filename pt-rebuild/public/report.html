<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>PT Therapist Portal</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <!-- Header -->
  <header>
    <button id="menu-btn" data-action="toggle-menu">☰</button>
    <h1>Therapist Portal</h1>
    <div id="menu-dropdown" style="display: none;">
      <button data-action="reload-app">⟳ Reload App</button>
      <button data-action="close-menu">Close</button>
    </div>
  </header>

  <!-- Login Screen -->
  <div id="login-screen">
    <h1>Therapist Portal</h1>
    <p>Sign in to continue</p>
    <button id="show-login-btn" data-action="show-login">Sign In</button>
    <div id="login-form" style="display: none;">
      <input type="email" id="email" placeholder="Email" autocomplete="email">
      <input type="password" id="password" placeholder="Password" autocomplete="current-password">
      <button id="login-btn" data-action="login">Login</button>
      <p id="login-error"></p>
    </div>
  </div>

  <!-- Main Portal -->
  <div id="portal-screen" style="display: none;">

    <!-- Patient Selection -->
    <div id="patient-select" style="padding: 16px; background: white; border-bottom: 1px solid #ddd;">
      <label for="patient-dropdown" style="display: block; margin-bottom: 8px; font-weight: 600;">Select Patient:</label>
      <select id="patient-dropdown" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        <option value="">Loading patients...</option>
      </select>
    </div>

    <!-- Tab Navigation -->
    <nav style="display: flex; background: white; border-bottom: 2px solid #ddd; position: sticky; top: 52px; z-index: 998;">
      <button data-action="show-exercises" style="flex: 1; padding: 16px; border: none; background: white; font-weight: 600; color: #3498db; border-bottom: 3px solid #3498db;">Exercise Library</button>
      <button data-action="show-assignments" style="flex: 1; padding: 16px; border: none; background: white; font-weight: 600; color: #7f8c8d;">Assignments</button>
    </nav>

    <!-- Exercise Library View -->
    <div id="exercises-view" style="padding: 16px;">
      <div style="display: flex; gap: 8px; margin-bottom: 16px;">
        <input type="search" id="exercise-search" placeholder="Search exercises..." style="flex: 1; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        <button data-action="add-exercise" style="padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 8px; font-weight: 600; white-space: nowrap;">+ Add</button>
      </div>
      <ul id="exercise-list" style="list-style: none;"></ul>
    </div>

    <!-- Assignments View -->
    <div id="assignments-view" style="display: none; padding: 16px;">
      <p id="no-patient-msg" style="text-align: center; color: #7f8c8d; padding: 40px 20px;">Select a patient to view their assignments</p>
      <div id="assignments-content" style="display: none;">
        <button data-action="assign-exercise" style="width: 100%; padding: 14px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; margin-bottom: 16px;">+ Assign Exercise</button>
        <ul id="assignments-list" style="list-style: none;"></ul>
      </div>
    </div>

    <!-- Bottom Nav -->
    <nav id="bottom-nav">
      <button data-action="show-exercises">Exercises</button>
      <button data-action="show-assignments">Assignments</button>
      <button data-action="logout">Logout</button>
    </nav>
  </div>

  <!-- Exercise Editor Modal -->
  <div id="exercise-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
    <div style="background: white; max-width: 600px; margin: 40px auto; border-radius: 8px; padding: 24px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 id="modal-title" style="margin: 0;">Add Exercise</h2>
        <button data-action="close-modal" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Exercise ID</label>
          <input type="text" id="edit-id" placeholder="e.g., ankle_eversion" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Name</label>
          <input type="text" id="edit-name" placeholder="Exercise name" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Description</label>
          <textarea id="edit-description" placeholder="Exercise description" rows="3" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Category</label>
          <select id="edit-category" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
            <option value="back_sij">Back/SIJ</option>
            <option value="knee">Knee</option>
            <option value="ankle">Ankle</option>
            <option value="hip">Hip</option>
            <option value="foot">Foot</option>
            <option value="vestibular">Vestibular</option>
            <option value="shoulder">Shoulder</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Pattern</label>
          <select id="edit-pattern" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
            <option value="both">Both (bilateral)</option>
            <option value="side">Side (per-side execution)</option>
          </select>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 12px;">
          <button data-action="save-exercise" style="flex: 1; padding: 14px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600;">Save</button>
          <button data-action="close-modal" style="flex: 1; padding: 14px; background: #95a5a6; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Assignment Editor Modal -->
  <div id="assignment-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
    <div style="background: white; max-width: 500px; margin: 80px auto; border-radius: 8px; padding: 24px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 id="assign-modal-title" style="margin: 0;">Assign Exercise</h2>
        <button data-action="close-assign-modal" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Exercise</label>
          <select id="assign-exercise" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
            <option value="">Select exercise...</option>
          </select>
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Dosage Type</label>
          <select id="assign-dosage-type" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
            <option value="reps">Reps</option>
            <option value="hold">Hold</option>
            <option value="duration">Duration</option>
            <option value="distance">Distance</option>
          </select>
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Sets</label>
          <input type="number" id="assign-sets" value="3" min="1" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Reps per Set</label>
          <input type="number" id="assign-reps" value="10" min="0" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        </div>

        <div>
          <label style="display: block; margin-bottom: 4px; font-weight: 600;">Seconds per Rep/Set</label>
          <input type="number" id="assign-seconds" value="0" min="0" style="width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;">
        </div>

        <div style="display: flex; gap: 12px; margin-top: 12px;">
          <button data-action="save-assignment" style="flex: 1; padding: 14px; background: #3498db; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600;">Save</button>
          <button data-action="close-assign-modal" style="flex: 1; padding: 14px; background: #95a5a6; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/js/report.js"></script>
</body>
</html>
