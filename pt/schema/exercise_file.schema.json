{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schema/exercise_file.schema.json",
  "title": "Exercise File",
  "description": "Schema for the exercise library JSON used by the PWA.",
  "type": "object",
  "properties": {
    "exercises": {
      "type": "array",
      "description": "List of exercise definitions.",
      "items": {
        "$ref": "#/$defs/exercise"
      },
      "minItems": 1
    }
  },
  "required": ["exercises"],
  "additionalProperties": false,
  "$defs": {
    "exercise": {
      "type": "object",
      "description": "Single exercise definition.",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(ex\\d{4}|[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26})$",
          "description": "Stable, non-human-readable ID. Legacy: ex0001 format. New: 26-character ULID (Crockford Base32)."
        },
        "canonical_name": {
          "type": "string",
          "minLength": 1,
          "description": "Clinically meaningful exercise name."
        },
        "pt_category": {
          "type": "string",
          "description": "High-level PT category for scheduling and grouping.",
          "enum": ["back_sij", "knee", "ankle", "hip", "vestibular", "foot", "other"]
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Neutral, step-wise description of how to perform the exercise."
        },
        "primary_muscles": {
          "type": "array",
          "description": "Muscles intentionally targeted; used for strong heat-map highlighting.",
          "items": {
            "type": "string"
          },
          "minItems": 0,
          "default": []
        },
        "secondary_muscles": {
          "type": "array",
          "description": "Meaningful stabilizers/synergists; may be rendered as lighter heat-map shading.",
          "items": {
            "type": "string"
          },
          "minItems": 0,
          "default": []
        },
        "pattern": {
          "type": "string",
          "description": "Base dosage pattern for the exercise, independent of program-specific values.",
          "enum": [
            "side",
            "both"
          ]
        },
        "pattern_modifiers": {
          "type": "array",
          "description": "Pattern-level modifiers indicating structural dosage changes (e.g., duration vs reps, alternating sides within set). Values are flags; actual numbers live in the program layer.",
          "items": {
            "type": "string",
            "enum": [
              "duration_seconds",
              "hold_seconds",
              "AMRAP",
              "distance_feet",
              "alternating"
            ]
          },
          "uniqueItems": true,
          "default": []
        },
        "equipment": {
          "$ref": "#/$defs/equipment"
        },
        "form_parameters_required": {
          "type": "array",
          "description": "Form parameters that MUST be specified in the program layer (variable values like weight, surface type, etc.).",
          "items": {
            "type": "string",
            "enum": [
              "eyes",
              "surface",
              "band_resistance",
              "band_position",
              "slope",
              "distance",
              "weight",
              "strap_position"
            ]
          },
          "uniqueItems": true,
          "default": []
        },
        "tags": {
          "$ref": "#/$defs/tags"
        },
        "guidance": {
          "$ref": "#/$defs/guidance"
        },
        "lifecycle": {
          "$ref": "#/$defs/lifecycle"
        },
        "added_date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date this exercise definition was added (YYYY-MM-DD), or null if unknown/not tracked."
        },
        "updated_date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date this exercise definition was last materially updated (YYYY-MM-DD), or null if never."
        },
        "supersedes": {
          "type": "array",
          "description": "Array of exercise IDs that this exercise replaces/supersedes. When set, the superseded exercises should be automatically archived.",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        },
        "superseded_by": {
          "type": ["string", "null"],
          "description": "The ID of the exercise that replaced/superseded this one. Set automatically when this exercise appears in another exercise's 'supersedes' array.",
          "default": null
        },
        "superseded_date": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "ISO 8601 timestamp when this exercise was superseded. Set automatically when superseded_by is set.",
          "default": null
        }
      },
      "required": [
        "id",
        "canonical_name",
        "pt_category",
        "description",
        "primary_muscles",
        "secondary_muscles",
        "pattern",
        "pattern_modifiers",
        "equipment",
        "form_parameters_required",
        "tags",
        "guidance",
        "lifecycle",
        "added_date",
        "updated_date"
      ],
      "additionalProperties": false
    },
    "equipment": {
      "type": "object",
      "description": "Equipment characteristics for this exercise.",
      "properties": {
        "required": {
          "type": "array",
          "description": "Equipment intrinsic to the exercise (cannot be removed without changing exercise definition).",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        },
        "optional": {
          "type": "array",
          "description": "Equipment used for comfort or modification.",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        }
      },
      "required": ["required", "optional"],
      "additionalProperties": false
    },
    "tags": {
      "type": "object",
      "description": "Tag groups for functional grouping, format/position, and visualization/heat-map mapping.",
      "properties": {
        "functional": {
          "type": "array",
          "description": "Functional group tags (e.g., balance, hip_strength, SIJ_control).",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        },
        "format": {
          "type": "array",
          "description": "Execution format tags (e.g., standing, supine, sidelying, seated, dynamic_control, static_hold, single_leg).",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        },
        "heatmap": {
          "type": "array",
          "description": "Optional body-region tags used for heat-map visualization.",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "default": []
        }
      },
      "required": ["functional", "format", "heatmap"],
      "additionalProperties": false
    },
    "guidance": {
      "type": "object",
      "description": "Guidance broken into external cues, motor cues, compensation warnings, and safety flags.",
      "properties": {
        "external_cues": {
          "type": "array",
          "description": "Visible or tactile cues (what to look at or contact).",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "motor_cues": {
          "type": "array",
          "description": "How to move; internal and external movement cues.",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "compensation_warnings": {
          "type": "array",
          "description": "Common compensation patterns to watch for and correct.",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "safety_flags": {
          "type": "array",
          "description": "Stop/modify conditions.",
          "items": {
            "type": "string"
          },
          "default": []
        }
      },
      "required": [
        "external_cues",
        "motor_cues",
        "compensation_warnings",
        "safety_flags"
      ],
      "additionalProperties": false
    },
    "lifecycle": {
      "type": "object",
      "description": "Lifecycle state for this exercise definition.",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["active", "archived"],
          "description": "Whether this exercise definition is actively used or archived."
        },
        "effective_start_date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date this exercise definition became active (YYYY-MM-DD), or null if unknown/not tracked."
        },
        "effective_end_date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "Date this exercise definition stopped being active (e.g., archived)."
        }
      },
      "required": ["status", "effective_start_date", "effective_end_date"],
      "additionalProperties": false
    }
  }
}
